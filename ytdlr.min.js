(()=>{window.ytdlr=(()=>ytdlr());let util={base:"https://www.youtube.com",between:(e,t,a,n=0,i=0)=>{t instanceof RegExp&&(t=e.match(t)[0]);let l=e.indexOf(t),s=e.indexOf(a,l);return a||(s=e.length),e.substring(l+t.length+i,s+n)},text:e=>"string"==typeof e?e.replace(/\+/g," "):e.simpleText||e.runs.map(e=>e.text).join("")};async function ytdlr(){let e=window.location.href.match(/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?.*?(?:v|list)=(.*?)(?:&|$)|^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?(?:(?!=).)*\/(.*)$/i);if(!e||!e[1])return;let t=e[1],a=await getPlayerData(),n=await getVideoData(t,a.sts),i=Object.values(n.streamingData.adaptiveFormats);return n.streamingData.formats&&i.push(...Object.values(n.streamingData.formats)),formatResponse(n,decipherFormats(i,a.fn))}async function getPlayerData(){let e=document.querySelector("head").innerHTML,t=JSON.parse(util.between(e,/window\.ytplayer.*?=.*?{};.*?ytcfg\.set\(/s,"})",1)),a=await fetch(t.PLAYER_JS_URL,{base:util.base}).then(e=>e.text());return{sts:t.STS,fn:getCipherFunction(a)}}function getCipherFunction(str){let keys=['a=a.split("")',"};","var ","(","="],js=util.between(str,`${keys[0]};${keys[2]}`),top=util.between(js,keys[0],keys[1],1,-28),fn=keys[2]+util.between(top,keys[0],keys[3],10,1).split(".")[0]+keys[4],side=util.between(js,fn,keys[1],2,-fn.length);return eval(side+top)}async function getVideoData(e,t,a){let n=new URL("get_video_info",util.base),i={video_id:e,eurl:"https://youtube.googleapis.com/v/"+e,ps:"default",gl:"US",hl:"en",el:a?"detailpage":"embedded",sts:t};return Object.keys(i).forEach(e=>n.searchParams.append(e,i[e])),parseData(await fetch(n).then(e=>e.text())).player_response}function parseData(e){let t={},a="object"==typeof e?Object.entries(e):e.split("&").map(e=>e.split("="));for(let e=0;e<a.length;e++){let n=a[e][0],i=a[e][1];"player_response"===n&&(i=JSON.parse(decodeURIComponent(i))),"object"==typeof i&&(i=parseData(i)),t[n]=i}return t}function decipherFormats(e,t){e=Object.values(e);for(let a=0;a<e.length;a++){let n=e[a];if(n.mimeType&&(n.mimeType=n.mimeType.replace(/\+/g," ")),n.signatureCipher){let e=parseData(n.signatureCipher);delete n.signatureCipher,n.url=`${decodeURIComponent(e.url)}&${e.sp}=${t(decodeURIComponent(e.s))}`}}return e}function formatResponse(e,t){let a=e.videoDetails,n=e.microformat.playerMicroformatRenderer,i=n.ownerProfileUrl,l=/(?<=codecs=").*(?=")/;return{info:{id:a.videoId,type:n.isUnlisted?"unlisted":"public",title:util.text(n.title).replace(/\+/g," "),description:n.description?util.text(n.description).replace(/\+/g," "):null,thumbnails:Object.values(a.thumbnail.thumbnails),date:n.publishDate,duration:1e3*Number(a.lengthSeconds),views:Number(a.viewCount),author:{id:a.channelId,vanity:i.indexOf("/user/")>=0?util.between(i,"/user/"):null,title:a.author.replace(/\+/g," ")}},formats:t=t.map(e=>{let t=e.mimeType.split(";");return{itag:e.itag,url:e.url,mime:t[0],codecs:t[1].match(l)[0].split(", "),quality:e.qualityLabel||e.audioQuality||null,stats:{width:e.width||null,height:e.height||null,bitrate:e.bitrate||null,samplerate:Number(e.audioSampleRate)||null,channels:e.audioChannels||null,size:Number(e.contentLength)||null,duration:Number(e.approxDurationMs)||null,fps:e.fps||null}}})}}})();